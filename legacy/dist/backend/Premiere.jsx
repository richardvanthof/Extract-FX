!function(){let e=app.enableQE();$._PPP_={message:function(e){},updateEventPanel:function(e,t="info"){$._PPP_.message(e),app.setSDKEventMessage(e,t)},getInstalledEffects:function(){let t=e.project.getVideoEffectList();return $._PPP_.message(t),t},searchForFileWithName:function(e){let t=app.project.rootItem.children.numItems,o=null;for(let a=0;a<t&&null===o;a++){let t=app.project.rootItem.children[a];t&&t.name===e&&(o=t)}return o},findInsertedClip:function(e,t){for(let o of e.clips)if(o.start.seconds===t.seconds)return o;return null},importFile:function(e){try{let t=app.project.rootItem;return app.project.importFiles(e,!0,t,!1)}catch(e){return e}},getAdjustmentLayer:function(){try{let e;let t="RSFX-container",o=$._PPP_.searchForFileWithName(t);if("Macintosh"===Folder.fs?e="/Library/Application Support/Adobe/CEP/extensions/space.therichard.ExtractFX/payloads/payloads/adjustment-layer.prproj":e="file:///C:/Program%20Files%20(x86)/Common%20Files/Adobe/CEP/extensions/space.therichard.ExtractFX/payloads/adjustment-layer.prproj",null===o){if($._PPP_.message("File not found. Importing..."),$._PPP_.importFile(e),o=$._PPP_.searchForFileWithName(t),null===o&&($._PPP_.message("File not found. Importing..."),$._PPP_.importFile(e),o=$._PPP_.searchForFileWithName(t),null===o))throw"Adjustment layer template not found. Try again or manually create a template file (see help-screen for more info)."}else $._PPP_.message("File found in the project.");return o}catch(e){return alert(e),e}},sanitized:function(e){return"motion"===e.toLowerCase()||"opacity"===e.toLowerCase()?"Transform":"ae.adbe motion"===e.toLowerCase()||"ae.adbe opacity"===e.toLowerCase()?"AE.ADBE Geometry":e},notDuplicateFx:function(e,t,o){if(o.numComponents>0){for(let a=0;a<o.numComponents;a++)if(o.getComponentAt(a).name.toLowerCase()===e.toLowerCase()&&e.toLowerCase()===t.toLowerCase())return!1}return!0},findComponentByName:function(e,t,o="displayName"){for(let a of($._PPP_.message(`Finding match for ${t}`),e))if($._PPP_.message(`-- ${a[o]}`),a[o]===t)return $._PPP_.message(`-- Match found: ${a[o]}`),a;return null},listContains:function(e,t){for(let o of t)if(o.toLowerCase()===e.toLowerCase())return!0;return!1},copySetting:function(e,t,o){try{let n=null,{sourceIn:r,targetIn:i,sourceRes:s}=o,l={w:app.project.activeSequence.frameSizeHorizontal,h:app.project.activeSequence.frameSizeVertical};function a(e,t,o,a){return"position"===t.toLowerCase()?[e[0]*(o.w/a.w),e[1]*(o.h/a.h)]:e}if("position"===t.displayName.toLowerCase()&&$._PPP_.message(`orginele transform pos: ${t.getValue()}`),t.areKeyframesSupported()&&e.getKeys()){let o=e.getKeys();for(let n of($._PPP_.message("Setting keyframes..."),t.setTimeVarying(!0),o)){let o=e.getValueAtKey(n),c=new Time;c.seconds=n.seconds-r.seconds+i.seconds;let f=a(o,e.displayName,s,l);t.addKey(c),t.setValueAtKey(c,f,1),$._PPP_.message(`---- Time: ${c.seconds} sec; Value: ${o}`)}}else{$._PPP_.message("Setting static value...");let o=e.getValue(),r=a(o,e.displayName,s,l);t&&o&&(n=t.setValue(r,1)),$._PPP_.message(`---- Value: ${o}`)}return n}catch(e){return $._PPP_.message("ERROR copySetting(): "+e),null}},copySettings:function(e,t,o){try{let a=$._PPP_.sanitized(e.matchName);$._PPP_.message(`Finding targetEffect for sourceEffect '${a}' (${e.matchName})`);let n=$._PPP_.findComponentByName(t.components,$._PPP_.sanitized(e.matchName),"matchName");if(n){for(let t of e.properties)if(!(t.displayName.length<=1)){if($._PPP_.message(`
- Copying setting '${t.displayName}' for effect ${$._PPP_.sanitized(e.matchName)}`),"scale"===t.displayName.toLowerCase()&&"AE.ADBE Geometry"===n.matchName){for(let e of["Scale Width","Scale Height"]){let a=$._PPP_.findComponentByName(n.properties,e);a&&$._PPP_.copySetting(t,a,o)}continue}{if("AE.ADBE Geometry"===n.matchName&&"opacity"===t.displayName.toLowerCase())continue;let e=$._PPP_.findComponentByName(n.properties,t.displayName);e&&$._PPP_.copySetting(t,e,o);continue}}}else throw`Component (aka. effect) ${e.displayName} as ${$._PPP_.sanitized(e.displayName)} not found.`;return!0}catch(e){alert(e),$._PPP_.message("ERROR copySettings(): "+e)}},getClipResolution:function(e){var t=e.projectItem.getProjectColumnsMetadata();if(t.length>0){var o=t[0]["premierePrivateProjectMetaData:Column.Intrinsic.VideoInfo"];if(o){var a=o.split(" x "),n=a[0],r=a[1].split(" ")[0];return $.writeln("Clip width: "+n),$.writeln("Clip height: "+r),{w:n,h:r}}$.writeln("Video info not found in metadata.")}else $.writeln("No columns metadata available.")},getEffects:function(e){var t={};for(let s of e.components){var o=t[s.displayName]={};for(let e of s.properties){var a=e.displayName;if(o[a]={},e.areKeyframesSupported()&&e.getKeys()){var n=[];for(let t of e.getKeys()){var r=e.getValueAtKey(t);n.push([t,r])}o[a].keyframes=n}else{var i=e.getValue();o[a].value=i}}}return t},getSep:function(){return"Macintosh"===Folder.fs?"/":"\\"},saveEffectstoFile:function(e=1,t=[]){try{let n=app.project.activeSequence;app.project.path;let r=n.name;if(!n)return alert("No active sequence found."),!1;let i=[],s=n.videoTracks[e-1];if(!s)throw"Please ensure the sourcetracks exist.";for(let e of s.clips){let t=$._PPP_.getEffects(e);i.push(t),$._PPP_.message(t)}var o=JSON.stringify({type:"RS-FX-EXCHANGE",track:e,sequence:r,exclusions:t,clips:i}),a=File.saveDialog("Save effects list");return a?("json"!==a.name.split(".").pop().toLowerCase()&&(a=new File(a.fullName+".json")),a.open("w")?(a.write(o),a.close()):alert("Failed to open the file for writing.")):alert("No file selected."),!0}catch(e){throw e}},copyClipEffectsToAdjustmentLayers:function(t,o=[]){try{if(!t)throw"Source track undefined.";function a(e){return app.project.activeSequence.videoTracks[e]||null}$._PPP_.updateEventPanel(`Track ${t} - Initializing effect extraction...`,"info");let n=app.project.activeSequence;if(!n)return alert("No active sequence found."),!1;let r=t||1,i=r+1,s=a(r-1),l=a(i-1),c=e.project.getActiveSequence().getVideoTrackAt(i-1);if(!s||!l)throw"Please ensure the source and target tracks exist.";if(s.clips.numItems<=0)throw"No clips on source track were found.";let f=$._PPP_.getAdjustmentLayer();for(let t=0;t<s.clips.numItems;t++){let a=s.clips[t],r=a.components,i=a.start;if($._PPP_.updateEventPanel(`

Moving effects from clip ${t} of ${s.clips.numItems}.`,"info"),r.numItems>0){let s=l.insertClip(f,i),p=l.clips[t],P={w:n.frameSizeHorizontal,h:n.frameSizeVertical},u={sourceIn:a.inPoint,targetIn:p.inPoint,sourceRes:P};if(s){let n=c.getItemAt(t+1);$._PPP_.findInsertedClip(l,i).end=a.end;for(let t=0;t<r.numItems;t++){let a=r[t],i=["Opacity",...o];$._PPP_.message(`Exlusions list: ${i}`);let s=$._PPP_.listContains(a.displayName,i);if(!1===s){let t;let o=$._PPP_.sanitized(a.displayName),r=e.project.getVideoEffectByName(o);$._PPP_.notDuplicateFx("Transform",o,n)?t=n.addVideoEffect(r):($._PPP_.message("- Skipped duplicate effect."),t=!1),t&&!$._PPP_.copySettings(a,p,u)&&$._PPP_.message("- Error occurred while adding effect settings.")}else $._PPP_.message(`Skipped: ${a.displayName}`)}}}}$._PPP_.updateEventPanel("Finished copying effects","info")}catch(e){return $._PPP_.updateEventPanel(e,"error"),alert(e),e}return!0},restoreEffectsToClips:function(t){try{let o=JSON.parse(t),{sourceData:a,exclusions:n}=o;if(!a)throw"Source data not found. JSON is undefined or malformed.";if(!app.project.activeSequence)return alert("No active sequence found."),!1;let r=o.targetTrack-1,i=app.project.activeSequence.videoTracks[r]||null,s=e.project.getActiveSequence().getVideoTrackAt(r);if(!i)throw"Target track undefined.";if(!i.clips)throw"Target track has no clips";let l=a.clips,c=i.clips;for(let t=0;t<l.length&&t<=c.numItems;t++){$._PPP_.updateEventPanel(`Restoring efffect for clip ${t} of ${l.length}`);let o=t+1,a=l[t],r=c[t],i=s.getItemAt(o);if(!r)throw"Target clip not found.";if(!i)throw"QE target clip not found.";for(let t in a){$._PPP_.message(`Exlusions list: ${n}`);let o=$._PPP_.listContains(t,n);if(!1===o){if("motion"!==t.toLowerCase()&&"opacity"!==t.toLowerCase()){let o=e.project.getVideoEffectByName(t);i.addVideoEffect(o)}let o=a[t],n=$._PPP_.findComponentByName(r.components,t);for(let e in o){let t=o[e],a=$._PPP_.findComponentByName(n.properties,e);if(t&&a){if(t.keyframes){a.setTimeVarying(!0);let{keyframes:e}=t;for(let[t,o]of e)a.addKey(t.seconds),a.setValueAtKey(t.seconds,o,1)}else a.setValue(t.value,1)}else throw"Target or source setting required but not found."}}}}return $._PPP_.updateEventPanel("Finishing task..."),!0}catch(e){return alert(e,e.name,e.message),$._PPP_.message(e),e}}}}();
//# sourceMappingURL=Premiere.js.map
